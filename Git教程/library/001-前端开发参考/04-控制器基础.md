# 控制器基础配置
>创建人：**Lee**  
>创建时间：2017-10-18  
>最后修改人：**Lee**  
>修改时间：2017-10-19 

本节主要说明如何配置一个模块的控制器，以及控制器内基本参数的含义。  

一个普通的控制器定义形式如下（这也是angular内定义控制器的方式）：   

```js
angular.module('EIPApp').controller('DemoCtrl', ['$scope', function ($scope) { 
    //控制器具体实现
}]);
```
在控制器中，我们引用了$scope服务(**<font color=red>必须</font>**)，并通过$scope来实现功能和业务逻辑等。 

在$scope上，我们需要定义一个名为outparamss属性，对标准页面来说，它是必有的。这个参数决定了浏览页面和编辑页面的内容和结构、展现方式等等。  

$scope还可以定义一个名为customfunction属性，它是可选的。在你需要在页面（编辑页？）上执行自定义的方法时使用，比如字段联动、自定义按钮的的方法等等。  

此时，控制器就更加丰富一点了。

```js
angular.module('EIPApp').controller('DemoCtrl', ['$scope', function ($scope) { 
    $scope.outparamss = {};
    $scope.customfunction = [];
}]);
```

## outparamss  
我们把outparamss‘分解’一下，它可以（目前来说）分为5块，分别是版本定义、页面初始化定义、数据定义、页面内容定义以及其它自定义内容，每一块都对应一个属性参数，如下表：  

| 属性名 | 类型 | 必选 | 说明
| :------: | :------: | :------: | :------
| API_VERSION | 数字 | 否 | 接口版本，主要是控制增删改查四大操作是否走通用的接口；默认为1.0，不走通用接口，由各模块自行实现；当设置此参数大于等于1.2时走通用增删改查的操作，无需各模块单独实现。
| init | 对象 | 是 | 页面初始化配置，主要是浏览页的默认查询参数配置和新建页面的需要默认赋值的字段配置。
| dataModule | 数组 | 是 | 数据配置
| pageModule | 数组 | 是 | 页面模型配置
| pageCustomBtn | 对象 | 否 | 其它配置  

### API_VERSION  
略
### init  
init也是一个对象，它有5个属性。  

| 属性名 | 类型 | 必选 | 说明
| :------: | :------: | :------: | :------
| initEditName | 字符串 | 是 | 后台控制器名，不带Controller。
| initPrimaryKey | 字符串 | 是 | 主键名称
| initParam | 对象 | ？ | 浏览和新建页的初始化配置
| inUrlSumbit | 对象 | ？ | 。。。
| initUrl | 对象 | ？ | 。。。  

1. initEditName  
对应后台的一个MVC控制器名，注意这里要和js控制器名称<font color=red>保持一致</font>，且不需要Controller后缀。
1. initPrimaryKey  
对应该模块数据库表的主键名称。
1. initParam  
初始化参数。  
1. inUrlSumbit  
待补充
1. initUrl  
待补充  

### dataModule  
数据模型配置。页面的具体配置块，包括列表页面和详情页面。它和pageModule相关联，它定义了页面的具体展示内容，pageModule则规定了各区块的显示顺序和各个区块的额外配置信息等内容。dataModule是个对象数组，它能接收的对象主要包括key和module两个属性。  

```js
dataModule:[
    {
        key: '',
        module: []
    }
]
```  

#### key  
字符串类型参数，取值没有规定，一般都是区块名，不能为中文。但在同一个页面或者同一个dataModule里，该参数不能重复。  

正确的写法：
```js
dataModule:[
    {
        key: 'key1',
        module: []
    },    
    {
        key: 'key2',
        module: []
    }
    {
        key: 'key3',
        module: []
    }
    ...
]
```  
错误的写法：

```js
dataModule:[
    {
        key: 'key1',
        module: []
    },    
    {
        key: 'key1',//key值重复
        module: []
    }
    {
        key: 'key2',
        module: []
    }
    ...
]
```   

<font color=red>当key值设置为COMMON_CONSTANT.BrowseKey（或'Browse_GridModule'）时，表明该区块为列表页配置。另外，每个页面有且仅有一个key值为COMMON_CONSTANT.BrowseKey（或'Browse_GridModule'）的配置块。</font>

#### module  
数组或对象类型参数。根据区块类型不同，对应module参数里接收的对象属性和参数也不尽相同。  

1. 浏览页面module配置
```js
//浏览页module配置
module: {
    eipGridTable: [],
    eipSimpleTable: [],
    eipAdvancedTable: [],
    isShowEdit: "true",
    isShowNew: "true",
    isShowDelete: "true",
    isShowExport: "true"
}
```

1. 详情页面module配置
```js
//详情页面module配置
module: [{
        name: '1：',
        bindModel: 'item.MODEL',
        type: 'type1',
        bindDict_code: 'DICT_DEMO_ANALYSE_1',
        row: 1,
        textColSpan: 2,
        contentColSpan: 3,
        disabled: "Cause_Disable"
    },
    {
        name: '2：',
        bindModel: 'item.MODEL',
        type: 'type2',
        row: 1,
        textColSpan: 2,
        contentColSpan: 3,
        disabled: "Cause_Disable"
    }
    ...
]
```

1. 详情页面内子表module配置
```js
//详情页面内子表module配置
module: {
    eipGridTable: [{
            name: '主键ID',
            field: 'REC_ID',
            visible: false,
            isDelKey: true
        },
        {
            name: '序号',
            field: 'ROW_NUM',
            visible: true
        }
        ...
    ],
    isShowEdit: "false",
    isShowNew: "false",
    isShowDelete: "false",
    isShowExport: "false"
}
```

1. 详情页面内附件module配置
```js
//详情页面内附件module配置
module: [{
    name: '',
    type: 'attachment',
    textColSpan: 1,
    contentColSpan: 12,
    row: 1,
    height: '100px',
    parentTableName: 'SYS_DEMO_PROBLEM',
    attachmentTableName: 'SYS_ATTACHMENTS',
    uploadActionName: 'AddAttachments',
    downloadActionName: 'GetAttachments',
    deleteActionName: 'DelAttachments',
    bindModel: 'item.AttachmentsList',
    modalWindowid: 'demoProblemAttachement',
    isShowUpload: "true",
    isShowEdit: "true",
    isShowDelete: "true"
}]
```

#### pageSetting  
浏览页自定义按钮？

```js
pageSetting: {
    customBtn: [{
        title: "自定义按钮",
        class: "btn-info",
        isShow: "true",
        event: "listTest($event)"
    }, ]
}
```

#### moduleGrid
子表弹窗带表格？
```js
moduleGrid: {
    eipGridTable: [{
            name: '主键ID',
            field: 'REC_CONTENT_ID',
            visible: false,
            isDelKey: true
        },
        {
            name: '字段1',
            field: 'REC_CONTENT'
        },
        {
            name: '字段2',
            field: 'REC_CONTENT'
        }
        ...
    ],
    tableName: "DC_SYS_DEMO_REC_CONTENT",
    tableUrl: "DemoProblem/GetRecContentList"
}
```

### pageModule  
页面模型配置，是个对象数组。它的内容取决于dataModule的配置，通过pageModule的配置，可以实现区块展示顺序调整，设置区块显/隐，自定义数据处理接口等功能。

```js
pageModule: [{
            type: 'Edit_Custom',
            moduleTitle: '基础信息',
            dataModuleName: 'Edit_Basic_Info'
        },
        ...
    ]
```

### pageCustomBtn  
其它配置（目前主要是页面内按钮配置？）,对象类型。  

```js
//其它配置
pageCustomBtn: {
    isSaveShow: true,
    isSaveCopyShow: true,
    isSaveNewShow: true,
    backUrl: "MainFrame.DemoProblem.Select",
    editBtn: [{
            pageNew: "true",
            title: "测试",
            class: "btn-danger",
            isShow: "true",
            event: "test($event)"
        },
        ...
    ]
}
```

**可以说，<font color=red size=5>outparamss</font> 是最重要的属性了，呵呵。**
## customfunction  
当你需要在页面内运行某个自定义的函数（比如某个字段值变化时更改另外一个字段的值）时，就需要customfunction了。具体操作步骤：
首先，在$scope上定义一个函数：

```js
$scope.testFunction = function(){
    //some code
};
```

其次，在customfunction里加入以下内容，将函数注册到$scope上去：

```js
$scope.customfunction = [
    {'name':'testFunction','value':'testFunction'}
];
```

这里面，name和value都是函数名称。  

整合一下：

```js
angular.module('EIPApp').controller('DemoCtrl', ['$scope', function ($scope) { 
    $scope.testFunction = function(){
        //some code
    };
    
    $scope.customfunction = [
        {'name':'testFunction','value':'testFunction'}
    ];
}]);
```

需要注意的是，在这里注册的函数，参数是通过函数参数的selectedItem对象来传递的。

