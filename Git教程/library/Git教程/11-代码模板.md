# 代码模板
>创建人：**Liu**  
>创建时间：2017-11-08    
>最后修改人：**Liu**  
>修改时间：2017-11-08     

模板分BLL模板和数据契约类模板，配合动软生成器生成代码，生成步骤参考[动软生成器代码生成](?file=002-后端开发参考/12-动软生成器代码生成 "动软生成器代码生成")。    

## 模板位置

..\TFS\企业项目平台\技术文档\动软生成代码模板   
BLL.cmt(BLL模板)  
DataContract.cmt(数据契约类模板)

## BLL模板

```js
<#@ template language="c#" HostSpecific="True" #>
<#@ output extension= ".cs" #>
<#
	TableHost host = (TableHost)(Host);	
	ColumnInfo identityKey=host.IdentityKey;
	string returnValue = "void";
    if (identityKey!=null)
    {         
         returnValue = CodeCommon.DbTypeToCS(identityKey.TypeName);              
    }
#>
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using WCFDataAccess;
using WCFDataAccess.AdoToOracle;
using WCFDataAccess.EFToOracle;
using WCFDataAccess.OracleEF;
using WCFDataContract;
using WCFDataContract.Common;
using WCFServiceLibrary;
using WCFDataContract.WorkFlow;
namespace WCFServiceLibrary.BLL  
{
	public class BLL_<#= host.GetBLLClass(host.TableName) #>
	{
		EIPEntities dbContext = new EIPEntities();
		
		#region 列表处理（查询结果、导出结果）
        /// <summary>
        /// 对查询结果处理
        /// </summary>
        /// <param name="dt">返回列表</param>
        /// <returns></returns>
        public DataTable GetBaseItemListAfter(DataTable dt)
        {
            return dt;
        }
		
		/// <summary>
        /// 对导出结果处理
        /// </summary>
        /// <param name="dt">返回列表</param>
        /// <returns></returns>
        public DataTable ExportBaseItemListAfter(DataTable dt)
        {
            return dt;
        }
		
        #endregion
		
		#region 新建保存
		/// <summary>
        /// 新建保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage AddBaseItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		
		/// <summary>
        /// 新建保存后方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage AddBaseItemAfter(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		#endregion
		
		#region 编辑保存
		/// <summary>
        /// 编辑保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage EditBaseItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		
		/// <summary>
        /// 编辑保存后方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage EditBaseItemAfter(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		#endregion
		
		#region 获取详情信息
		/// <summary>
        /// 获取详情信息之后调用方法
        /// </summary>
        /// <param name="controllerName">controller名称</param>
		/// <param name="loginUid">登录用户ID</param>
		/// <param name="model">数据</param>
        /// <returns></returns>
        public DC_<#= host.GetBLLClass(host.TableName) #> GetBaseItemByIDAfter(string controllerName, string loginUid, DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
			return model;
        }
		#endregion
		
		#region 删除
		/// <summary>
        /// 删除前方法
        /// </summary>
        /// <param name="iDs">主键IDS,多个用","隔开</param>
        /// <returns></returns>
        public ResultMessage DeleteBaseItemBefore(string iDs)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		
		/// <summary>
        /// 删除后方法
        /// </summary>
        /// <param name="iDs">主键IDS,多个用","隔开</param>
        /// <returns></returns>
        public ResultMessage DeleteBaseItemAfter(string iDs)
        {
			ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
			rm.strMessage = string.Empty;
			return rm;
        }
		#endregion
		
		#region 联合子表查询、新增、编辑
		
		#region 查询详情
		/// <summary>
        /// 根据外键获取数据列表--一对多
        /// </summary>
        /// <param name="tableName">表名称</param>
        /// <param name="fkName">外键名称</param>
        /// <param name="fkValue">外键值</param>
        /// <returns></returns>
        public List<DC_<#= host.GetBLLClass(host.TableName) #>> GetListByForeignKey(string parentTable, string tableName, string fkName, string fkValue)
        {
        	List<DC_<#= host.GetBLLClass(host.TableName) #>> resultList = new List<DC_<#= host.GetBLLClass(host.TableName) #>>();
            try
            {
                string dataSql = string.Format(@"SELECT * FROM {0} WHERE {1} = '{2}'", tableName, fkName, fkValue);
                //执行查询
                resultList = dbContext.Database.SqlQuery<DC_<#= host.GetBLLClass(host.TableName) #>>(dataSql).ToList();
                return resultList;
            }
            catch(Exception ex)
            {
            	throw ex;
            }
        }
		
		/// <summary>
        /// 根据外键获取数据列表--一对一
        /// </summary>
        /// <param name="tableName">表名称</param>
        /// <param name="fkName">外键名称</param>
        /// <param name="fkValue">外键值</param>
        /// <returns></returns>
        public DC_<#= host.GetBLLClass(host.TableName) #> GetSingleByForeignKey(string parentTable, string tableName, string fkName, string fkValue)
        {
            DC_<#= host.GetBLLClass(host.TableName) #> result = new DC_<#= host.GetBLLClass(host.TableName) #>();
            try
            {
                string dataSql = string.Format(@"SELECT * FROM {0} WHERE {1} = '{2}'", tableName, fkName, fkValue);
                //执行查询
                result = dbContext.Database.SqlQuery<DC_<#= host.GetBLLClass(host.TableName) #>>(dataSql).FirstOrDefault();
                return result;
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
        #endregion
        
        #region 子表新增、编辑、删除
        #region 子表新增
        /// <summary>
        /// 新建保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage AddChildItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }

        /// <summary>
        /// 新建保存后方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage AddChildItemAfter(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }
        #endregion

        #region 编辑保存
        /// <summary>
        /// 编辑保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage EditChildItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }

        /// <summary>
        /// 编辑保存后方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage EditChildItemAfter(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }
        #endregion

        #region 删除
        /// <summary>
        /// 删除前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage DelChildItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }

        /// <summary>
        /// 删除后方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage DelChildItemAfter(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }
        #endregion
        #endregion
        
		#endregion

		#region 获取导出Word数据

        /// <summary>
        /// 获取导出Word数据
        /// </summary>
        /// <param name="recordID">记录ID</param>
        /// <param name="mapParty">同一个页面，用于确定哪一个导出</param>
        /// <returns>Dictionary</returns>
        public Dictionary<string, string> GetExportData(string recordID, string mapParty)
        {
            dct.Add("1", "1");
            dct.Add("2", "2");
            return dct;
        }

        #endregion


        #region 工作流相关

        /// <summary>
        /// 工作流按钮显示隐藏控制后方法
        /// </summary>
		/// <param name="modCode">菜单Code</param>
        /// <param name="recordID">记录ID</param>
        /// <param name="loginUid">登录用户ID</param>		
        /// <param name="wfButton">工作流按钮</param>		
        /// <returns></returns>
        public WfButtonsShowContract InitWfButtonAfter(string modCode, string recordID, string loginUid, WfButtonsShowContract wfButton)
        {
            return wfButton;
        }

        /// <summary>
        /// 工作流新建保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage WfAddBaseItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            //DATA_STATUS赋默认值
            model.DICT_DEMO_PROBLEM_STATUS = "1";
            return rm;
        }

        /// <summary>
        /// 工作流编辑保存前方法
        /// </summary>
        /// <param name="model">数据对象</param>
        /// <returns></returns>
        public ResultMessage WfEditBaseItemBefore(DC_<#= host.GetBLLClass(host.TableName) #> model)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }

        /// <summary>
        /// 工作流完成后方法
        /// </summary>
        /// <param name="recordID">记录ID</param>
        /// <param name="loginUid">登录用户ID</param>
        /// <returns></returns>
        public ResultMessage WfAfter(string recordID, string loginUid)
        {
            ResultMessage rm = new ResultMessage();
            rm.IsSuccess = true;
            rm.strMessage = string.Empty;
            return rm;
        }

        #endregion
	}
}
```

## 数据契约类模板代码

```js
<#@ template language="c#" HostSpecific="True" #>
<#@ output extension= ".cs" #>
<#
	TableHost host = (TableHost)(Host);
	host.Fieldlist.Sort(CodeCommon.CompareByintOrder);
#>
using System; 
using System.Text;
using System.Collections.Generic; 
using System.Data;
using System.Runtime.Serialization;
namespace  WCFDataContract
{
	<# if( host.TableDescription.Length > 0) {#>
 	//<#= host.TableDescription #>
	<# } #>
[DataContract]
	public class DC_<#= host.GetModelClass(host.TableName) #>
	{  		     
      	<# foreach (ColumnInfo c in host.Fieldlist)
		{ #>/// <summary>
		/// <#= string.IsNullOrEmpty(c.Description) ? c.ColumnName : c.Description #>
        /// </summary>
        [DataMember,MemberName("<#= string.IsNullOrEmpty(c.Description) ? c.ColumnName : c.Description #>")]
        public <#= CodeCommon.DbTypeToCS(c.TypeName) #> <#= c.ColumnName #>{ get; set; }
		<# } #>   
	}
}
```  

<font color=red>**备注：模板必须使用UTF-8格式** </font>   

