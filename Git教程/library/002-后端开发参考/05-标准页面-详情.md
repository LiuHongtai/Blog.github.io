# 标准页面-详情
>创建人：**Liu**  
>创建时间：2017-10-24  
>最后修改人：**Liu**  
>修改时间：2017-10-24  

标准页面的查询详情，连同子表信息一块返回。

## 规则约束

同<font color=red>**标准页面-新增**</font>  

## 开发实现
   
需要文件：数据契约类和BLL类

### 数据契约类

同<font color=red>**标准页面-新增**</font>  

## BLL类

1、文件位置：同<font color=red>**标准页面-新增**</font>
2、文件名称：同<font color=red>**标准页面-新增**</font>  
3、BLL类(获取详情相关)：  
```js
using ...
namespace WCFServiceLibrary.BLL  
{
	public class BLL_SYS_DEMO_PROBLEM
	{
		EIPEntities dbContext = new EIPEntities();
	    #region 主表-获取详情信息
		/// <summary>
        /// 获取详情信息之后调用方法
        /// </summary>
        /// <param name="model">主键ID</param>
        /// <returns></returns>
        public DC_SYS_DEMO_PROBLEM GetBaseItemByIDAfter(string controllerName, DC_SYS_DEMO_PROBLEM model)
        {
            
            try
            {
                //根据创建人获取创建人名称
                string userName = dbContext.SYS_USER.Find(model.OP_CREATE_USER).USER_NAME;
                model.OP_CREATE_UNAME = userName;
                //设置区块显示隐藏
                List<DC_SETBLOCKHIDE> listSetBlockHide = new List<DC_SETBLOCKHIDE>();
                switch (model.DICT_DEMO_PROBLEM_STATUS)
                {
                    case "1": //未提交
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Cause_Analysis", hide = true });
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Rectify_Info", hide = true });
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Acceptance_Info", hide = true });
                        break;
                    case "2"://原因分析中
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Rectify_Info", hide = true });
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Acceptance_Info", hide = true });
                        break;
                    case "3"://整改中
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Acceptance_Info", hide = true });
                        break;
                    case "4"://已整改
                        listSetBlockHide.Add(new DC_SETBLOCKHIDE() { scopeName = "Hide_Acceptance_Info", hide = true });
                        break;
                    default:
                        break;
                }
                model.SetBlockHide = listSetBlockHide;
            }
            catch (Exception ex)
            {
                throw ex;
            }
			return model;
        }
		#endregion
        ...
        #region 子表--查询详情
		/// <summary>
        /// 根据外键获取数据列表--一对多
        /// </summary>
        /// <param name="parentTable">父表名称</param>
        /// <param name="tableName">表名称</param>
        /// <param name="fkName">外键名称</param>
        /// <param name="fkValue">外键值</param>
        /// <returns></returns>
        public List<DC_SYS_DEMO_PROBLEM> GetListByForeignKey(string parentTable, string tableName, string fkName, string fkValue)
        {
        	List<DC_SYS_DEMO_PROBLEM> resultList = new List<DC_SYS_DEMO_PROBLEM>();
            try
            {
                string dataSql = string.Format(@"SELECT * FROM {0} WHERE {1} = '{2}'", tableName, fkName, fkValue);
                //执行查询
                resultList = dbContext.Database.SqlQuery<DC_SYS_DEMO_PROBLEM>(dataSql).ToList();
                return resultList;
            }
            catch(Exception ex)
            {
            	throw ex;
            }
        }
		
		/// <summary>
        /// 根据外键获取数据列表--一对一
        /// </summary>
        /// <param name="parentTable">父表名称</param>
        /// <param name="tableName">表名称</param>
        /// <param name="fkName">外键名称</param>
        /// <param name="fkValue">外键值</param>
        /// <returns></returns>
        public DC_SYS_DEMO_PROBLEM GetSingleByForeignKey(string parentTable, string tableName, string fkName, string fkValue)
        {
            DC_SYS_DEMO_PROBLEM result = new DC_SYS_DEMO_PROBLEM();
            try
            {
                string dataSql = string.Format(@"SELECT * FROM {0} WHERE {1} = '{2}'", tableName, fkName, fkValue);
                //执行查询
                result = dbContext.Database.SqlQuery<DC_SYS_DEMO_PROBLEM>(dataSql).FirstOrDefault();
                return result;
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
        #endregion
    }
}
```  
GetBaseItemByIDAfter方法为业务表作为主表时获取详情后方法，参数为控制器名称和模型数据，返回值为模型数据，主要用于获取主表信息后的逻辑控制。  
GetListByForeignKey为业务表作为一对多子表时，获取列表操作，参数分别为主表表名、自身表名、主表主键名称和主键值，返回值为列表数据，用于在详情页获取子表列表。    
GetSingleByForeignKey为业务表作为一对一子表时，获取子表数据，参数分别为主表表名、自身表名、主表主键名称和主键值，返回值为子表模型数据，用于在详情页获取子表数据。 

使用同<font color=red>**标准页面-新增** </font>方法类似。
