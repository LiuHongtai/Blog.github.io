# 附件转换
>创建人：**Liu**  
>创建时间：2017-11-07  
>最后修改人：**Liu**  
>修改时间：2017-11-07 

对上传的附件格式进行转换，转换对象为Word、Excel、PPT，转换后在同文件夹下生成PDF和SWF文件。

## 定时任务运行服务器上安装Swftools.exe 

### 获取安装软件
   
Swftools.exe放在150服务器TFS上，路径：企业项目平台/软件/Swftools.exe，获取（软件版本为0.9.0）。 

### 安装

在定时任务运行服务器上安装Swftools.exe，安装路径：C:\SWFTools（一定要是这个路径）。  
注意：安装前查看该服务器是否已经安装过Swftools！
 

## 在定时任务管理系统中配置任务

### 定时任务所属系统字典项配置

进入http://11.0.1.150/job/index.aspx，用户名：admin 密码：1。菜单路径：功能菜单/管理维护/数据字典管理/数据字典-列表，搜索字典名称”定时”，如下：  
![](assets/002/10-1510042855000.png)    
选中修改，添加需要附件转换定时任务的系统：  
![](assets/002/10-1510042878000.png) 

### 配置定时任务信息 

菜单路径：功能菜单/定时任务配置/定时任务配置/定时任务配置，点击进入，如下：      
![](assets/002/10-1510042930000.png)    

1、新建触发器信息，所属系统+触发器编码组合唯一，如下：    
![](assets/002/10-1510042978000.png)    
（1）所属系统、触发器编码、触发器分组编码、触发器表达式、是否启用，这5个字段信息在windows系统服务启动时抓取一次，执行过程中不重复抓取。  因  此，当这5个字段信息修改时，需要重启定时服务才能生效。    
（2）触发器表达式为功能强大的cron表达式，cron表达式用来定义触发器触发的规则。    Cron表达式详细可参考以下页面      
http://www.cnblogs.com/linjiqin/archive/2013/07/08/3178452.html  

2、配置触发器所要触发的服务  
![](assets/002/10-1510043047000.png)    
（1）子记录中任务编码为唯一标示    
（2）任务Web服务接口为http://应用程序服务器IP:端口/Attach2Pdf.asmx/ConvertAttachmentsToSwf;     
注：定时服务配置明细信息修改时，不需要重新启动windows系统服务即可生效。  

## 部署定时服务

### 下载定时任务程序  
定时任务放在150服务器TFS上，路径：  
企业项目平台/代码/附件转换定时任务,放到本地后解压

### 修改配置文件AppConfiguration.xml

```js
<!--/*
********针对每一个系统的定时任务都需要修改该配置文件的相应配置项*************
说明：修改完该配置文件后需要编译到bin目录下面去
ConnectString：配置数据库连接字符串
TriggerSystem：配置触发器所属系统，即对应常量QUARTZ_TRIGGER_SYSTEM的字典项id
*/
-->
```  
![](assets/002/10-1510043202000.png)  

### 部署windows系统服务

![](assets/002/10-1510043230000.png)  
（1）将程序文件放到服务器上，程序文件中存在nssm.exe，借助nssm.exe软件发布windows系统服务。  
（2）管理员身份进入命令提示符界面，cd命令进入定时任务根（存放nssm.exe的目录）目录，然后执行nssm install hseQuartzService 命令，其中  hseQuartzService为所要部署的windows系统服务名称，可自由命名。  
![](assets/002/10-1510043265000.png)  
（3）执行nssm install命令后出现以下界面，在path处点击选择定时任务可执行文件，然后点击Install service按钮，即可成功安装windows系统服务。  
![](assets/002/10-1510043289000.png)  
![](assets/002/10-1510043297000.png)







